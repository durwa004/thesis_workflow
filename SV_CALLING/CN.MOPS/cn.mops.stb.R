#module load R/3.5.0
library(cn.mops)

BAMFiles <- c("./ibio_output_files/CUTR0137A/CUTR0137A.recalibrated.bam", "./ibio_output_files/CUTR0138A/CUTR0138A.recalibrated.bam", "./ibio_output_files/FRTR0139A/FRTR0139A.recalibrated.bam", "./ibio_output_files/FRTR0023A/FRTR0023A.recalibrated.bam", "./ibio_output_files/FRTR0024A/FRTR0024A.recalibrated.bam", "./ibio_output_files/FRTR0025A/FRTR0025A.recalibrated.bam", "./ibio_output_files/FRTR0026A/FRTR0026A.recalibrated.bam", "./ibio_output_files/FRTR0027A/FRTR0027A.recalibrated.bam", "./ibio_output_files/FRTR0140A/FRTR0140A.recalibrated.bam", "./ibio_output_files/FRTR0028A/FRTR0028A.recalibrated.bam", "./ibio_output_files/FRTR0029A/FRTR0029A.recalibrated.bam", "./ibio_output_files/FRTR0030A/FRTR0030A.recalibrated.bam", "./ibio_output_files/SRR5755256/SRR5755256.recalibrated.bam", "./ibio_output_files/SATR0021A/SATR0021A.recalibrated.bam", "./ibio_output_files/SATR0022A/SATR0022A.recalibrated.bam", "./ibio_output_files/SRR4054238/SRR4054238.recalibrated.bam", "./ibio_output_files/SRR4054239/SRR4054239.recalibrated.bam", "./ibio_output_files/M6117/M6117.recalibrated.bam", "./ibio_output_files/M6138/M6138.recalibrated.bam", "./ibio_output_files/M6137/M6137.recalibrated.bam", "./ibio_output_files/M1433/M1433.recalibrated.bam", "./ibio_output_files/M1458/M1458.recalibrated.bam", "./ibio_output_files/M1005/M1005.recalibrated.bam", "./ibio_output_files/M1009/M1009.recalibrated.bam", "./ibio_output_files/M1012/M1012.recalibrated.bam", "./ibio_output_files/M1027/M1027.recalibrated.bam", "./ibio_output_files/M1048/M1048.recalibrated.bam", "./ibio_output_files/M10996/M10996.recalibrated.bam", "./ibio_output_files/M5256/M5256.recalibrated.bam", "./ibio_output_files/M5259/M5259.recalibrated.bam", "./ibio_output_files/M5260/M5260.recalibrated.bam", "./ibio_output_files/M5269/M5269.recalibrated.bam", "./ibio_output_files/M5271/M5271.recalibrated.bam", "./ibio_output_files/M5287/M5287.recalibrated.bam", "./ibio_output_files/M5300/M5300.recalibrated.bam", "./ibio_output_files/M5304/M5304.recalibrated.bam", "./ibio_output_files/M5306/M5306.recalibrated.bam", "./ibio_output_files/M968/M968.recalibrated.bam", "./ibio_output_files/M977/M977.recalibrated.bam", "./ibio_output_files/M989/M989.recalibrated.bam", "./ibio_output_files/M992/M992.recalibrated.bam", "./ibio_output_files/STAN0149A/STAN0149A.recalibrated.bam", "./ibio_output_files/M8679/M8679.recalibrated.bam", "./ibio_output_files/M8738/M8738.recalibrated.bam", "./ibio_output_files/M10664/M10664.recalibrated.bam", "./ibio_output_files/SRR2102500/SRR2102500.recalibrated.bam", "./ibio_output_files/M6184/M6184.recalibrated.bam", "./ibio_output_files/M6167/M6167.recalibrated.bam", "./ibio_output_files/M6175/M6175.recalibrated.bam", "./ibio_output_files/M6188/M6188.recalibrated.bam", "./ibio_output_files/M6850/M6850.recalibrated.bam", "./ibio_output_files/M6911/M6911.recalibrated.bam", "./ibio_output_files/M6991/M6991.recalibrated.bam", "./ibio_output_files/M6993/M6993.recalibrated.bam", "./ibio_output_files/M6115/M6115.recalibrated.bam", "./ibio_output_files/M6122/M6122.recalibrated.bam", "./ibio_output_files/M6130/M6130.recalibrated.bam", "./ibio_output_files/M6163/M6163.recalibrated.bam", "./ibio_output_files/M6166/M6166.recalibrated.bam", "./ibio_output_files/M6182/M6182.recalibrated.bam", "./ibio_output_files/M6187/M6187.recalibrated.bam", "./ibio_output_files/M6105/M6105.recalibrated.bam", "./ibio_output_files/M6194/M6194.recalibrated.bam", "./ibio_output_files/M6202/M6202.recalibrated.bam", "./ibio_output_files/ERR1527970/ERR1527970.recalibrated.bam")
RefSeqNames = c("NC_009144.3", "NC_009145.3", "NC_009146.3", "NC_009147.3", "NC_009148.3", "NC_009149.3", "NC_009150.3", "NC_009151.3", "NC_009152.3", "NC_009153.3", "NC_009154.3", "NC_009155.3", "NC_009156.3", "NC_009157.3", "NC_009158.3", "NC_009159.3", "NC_009160.3", "NC_009161.3", "NC_009162.3", "NC_009163.3", "NC_009164.3", "NC_009165.3", "NC_009166.3", "NC_009167.3", "NC_009168.3", "NC_009169.3", "NC_009170.3", "NC_009171.3", "NC_009172.3", "NC_009173.3", "NC_009174.3", "NC_009175.3", "NC_001640.1")
sampleNames = c("CUTR0137A", "CUTR0138A", "FRTR0139A", "FRTR0023A", "FRTR0024A", "FRTR0025A", "FRTR0026A", "FRTR0027A", "FRTR0140A", "FRTR0028A", "FRTR0029A", "FRTR0030A", "SRR5755256", "SATR0021A", "SATR0022A", "SRR4054238", "SRR4054239", "M6117", "M6138", "M6137", "M1433", "M1458", "M1005", "M1009", "M1012", "M1027", "M1048", "M10996", "M5256", "M5259", "M5260", "M5269", "M5271", "M5287", "M5300", "M5304", "M5306", "M968", "M977", "M989", "M992", "STAN0149A", "M8679", "M8738", "M10664", "SRR2102500", "M6184", "M6167", "M6175", "M6188", "M6850", "M6911", "M6991", "M6993", "M6115", "M6122", "M6130", "M6163", "M6166", "M6182", "M6187", "M6105", "M6194", "M6202", "ERR1527970")
bamDataRanges <- getReadCountsFromBAM(BAMFiles,sampleNames, RefSeqNames, WL = 5000, parallel=4)
res <- cn.mops(bamDataRanges)
#Calculate integer copy numbers
results <- calcIntegerCopyNumbers(res)
segm <- as.data.frame(segmentation(results))
#Identify CNVs
CNVs <- as.data.frame(cnvs(results))
#Identify CNV regions
CNVRegions <- as.data.frame(cnvr(results))
#Output data
write.csv(segm,file='ibio_stb_segmentation.csv')
write.csv(CNVs,file='ibio_stb_CNVs.csv')
write.csv(CNVRegions,file='ibio_stb_CNVR.csv')
