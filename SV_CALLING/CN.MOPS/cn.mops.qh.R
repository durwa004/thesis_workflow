#module load R/3.5.0
library(cn.mops)

BAMFiles <- c("./ibio_output_files/M10665/M10665.recalibrated.bam", "./ibio_output_files/SRR388336/SRR388336.recalibrated.bam", "./ibio_output_files/SRR388337/SRR388337.recalibrated.bam", "./ibio_output_files/M11001/M11001.recalibrated.bam", "./ibio_output_files/M11017/M11017.recalibrated.bam", "./ibio_output_files/M4409/M4409.recalibrated.bam", "./ibio_output_files/M4410/M4410.recalibrated.bam", "./ibio_output_files/M4411/M4411.recalibrated.bam", "./ibio_output_files/M4418/M4418.recalibrated.bam", "./ibio_output_files/M4435/M4435.recalibrated.bam", "./ibio_output_files/M4437/M4437.recalibrated.bam", "./ibio_output_files/M4438/M4438.recalibrated.bam", "./ibio_output_files/M4440/M4440.recalibrated.bam", "./ibio_output_files/M4486/M4486.recalibrated.bam", "./ibio_output_files/M4487/M4487.recalibrated.bam", "./ibio_output_files/M4488/M4488.recalibrated.bam", "./ibio_output_files/M4493/M4493.recalibrated.bam", "./ibio_output_files/M4537/M4537.recalibrated.bam", "./ibio_output_files/M4540/M4540.recalibrated.bam", "./ibio_output_files/M4541/M4541.recalibrated.bam", "./ibio_output_files/M4546/M4546.recalibrated.bam", "./ibio_output_files/SRR6175111/SRR6175111.recalibrated.bam", "./ibio_output_files/SRR6175110/SRR6175110.recalibrated.bam", "./ibio_output_files/ERR1527969/ERR1527969.recalibrated.bam", "./ibio_output_files/SRR6175109/SRR6175109.recalibrated.bam", "./ibio_output_files/SRR6175108/SRR6175108.recalibrated.bam", "./ibio_output_files/SRR6175104/SRR6175104.recalibrated.bam", "./ibio_output_files/M10666/M10666.recalibrated.bam", "./ibio_output_files/M10646/M10646.recalibrated.bam", "./ibio_output_files/ERR1527968/ERR1527968.recalibrated.bam", "./ibio_output_files/SRR6175107/SRR6175107.recalibrated.bam", "./ibio_output_files/SRR6175106/SRR6175106.recalibrated.bam", "./ibio_output_files/SRR6175105/SRR6175105.recalibrated.bam", "./ibio_output_files/M10993/M10993.recalibrated.bam", "./ibio_output_files/M11025/M11025.recalibrated.bam", "./ibio_output_files/M10647/M10647.recalibrated.bam", "./ibio_output_files/M7572/M7572.recalibrated.bam", "./ibio_output_files/M10652/M10652.recalibrated.bam", "./ibio_output_files/M10653/M10653.recalibrated.bam", "./ibio_output_files/M10659/M10659.recalibrated.bam", "./ibio_output_files/M10643/M10643.recalibrated.bam", "./ibio_output_files/M10644/M10644.recalibrated.bam", "./ibio_output_files/M10645/M10645.recalibrated.bam", "./ibio_output_files/A1543/A1543.recalibrated.bam", "./ibio_output_files/A2068/A2068.recalibrated.bam", "./ibio_output_files/A2071/A2071.recalibrated.bam", "./ibio_output_files/A2085/A2085.recalibrated.bam", "./ibio_output_files/A5659/A5659.recalibrated.bam", "./ibio_output_files/A5964/A5964.recalibrated.bam", "./ibio_output_files/M10990/M10990.recalibrated.bam", "./ibio_output_files/M10991/M10991.recalibrated.bam", "./ibio_output_files/M10992/M10992.recalibrated.bam", "./ibio_output_files/M10994/M10994.recalibrated.bam", "./ibio_output_files/M10995/M10995.recalibrated.bam", "./ibio_output_files/M10997/M10997.recalibrated.bam", "./ibio_output_files/M11004/M11004.recalibrated.bam", "./ibio_output_files/M11007/M11007.recalibrated.bam", "./ibio_output_files/M11010/M11010.recalibrated.bam", "./ibio_output_files/M11012/M11012.recalibrated.bam", "./ibio_output_files/M11015/M11015.recalibrated.bam", "./ibio_output_files/M11016/M11016.recalibrated.bam", "./ibio_output_files/M11018/M11018.recalibrated.bam", "./ibio_output_files/M11019/M11019.recalibrated.bam", "./ibio_output_files/M11021/M11021.recalibrated.bam", "./ibio_output_files/M11023/M11023.recalibrated.bam", "./ibio_output_files/M11024/M11024.recalibrated.bam", "./ibio_output_files/M4467/M4467.recalibrated.bam", "./ibio_output_files/M4472/M4472.recalibrated.bam", "./ibio_output_files/M4475/M4475.recalibrated.bam", "./ibio_output_files/M4476/M4476.recalibrated.bam", "./ibio_output_files/M4513/M4513.recalibrated.bam", "./ibio_output_files/M4514/M4514.recalibrated.bam", "./ibio_output_files/M4515/M4515.recalibrated.bam", "./ibio_output_files/M4527/M4527.recalibrated.bam")
RefSeqNames = c("NC_009144.3", "NC_009145.3", "NC_009146.3", "NC_009147.3", "NC_009148.3", "NC_009149.3", "NC_009150.3", "NC_009151.3", "NC_009152.3", "NC_009153.3", "NC_009154.3", "NC_009155.3", "NC_009156.3", "NC_009157.3", "NC_009158.3", "NC_009159.3", "NC_009160.3", "NC_009161.3", "NC_009162.3", "NC_009163.3", "NC_009164.3", "NC_009165.3", "NC_009166.3", "NC_009167.3", "NC_009168.3", "NC_009169.3", "NC_009170.3", "NC_009171.3", "NC_009172.3", "NC_009173.3", "NC_009174.3", "NC_009175.3", "NC_001640.1")
sampleNames = c("M10665", "SRR388336", "SRR388337", "M11001", "M11017", "M4409", "M4410", "M4411", "M4418", "M4435", "M4437", "M4438", "M4440", "M4486", "M4487", "M4488", "M4493", "M4537", "M4540", "M4541", "M4546", "SRR6175111", "SRR6175110", "ERR1527969", "SRR6175109", "SRR6175108", "SRR6175104", "M10666", "M10646", "ERR1527968", "SRR6175107", "SRR6175106", "SRR6175105", "M10993", "M11025", "M10647", "M7572", "M10652", "M10653", "M10659", "M10643", "M10644", "M10645", "A1543", "A2068", "A2071", "A2085", "A5659", "A5964", "M10990", "M10991", "M10992", "M10994", "M10995", "M10997", "M11004", "M11007", "M11010", "M11012", "M11015", "M11016", "M11018", "M11019", "M11021", "M11023", "M11024", "M4467", "M4472", "M4475", "M4476", "M4513", "M4514", "M4515", "M4527")
bamDataRanges <- getReadCountsFromBAM(BAMFiles,sampleNames, RefSeqNames, WL = 5000, parallel=4)
res <- cn.mops(bamDataRanges)
#Calculate integer copy numbers
results <- calcIntegerCopyNumbers(res)
segm <- as.data.frame(segmentation(results))
#Identify CNVs
CNVs <- as.data.frame(cnvs(results))
#Identify CNV regions
CNVRegions <- as.data.frame(cnvr(results))
#Output data
write.csv(segm,file='ibio_qh_segmentation.csv')
write.csv(CNVs,file='ibio_qh_CNVs.csv')
write.csv(CNVRegions,file='ibio_qh_CNVR.csv')
