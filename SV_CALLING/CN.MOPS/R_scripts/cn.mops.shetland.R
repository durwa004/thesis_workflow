#module load R/3.5.0
library(cn.mops)

BAMFiles <- c("./ibio_output_files/BROOKS3147/BROOKS3147.recalibrated.bam", "./ibio_output_files/M4814/M4814.recalibrated.bam", "./ibio_output_files/M4815/M4815.recalibrated.bam", "./ibio_output_files/M4826/M4826.recalibrated.bam", "./ibio_output_files/SRR3900348/SRR3900348.recalibrated.bam", "./ibio_output_files/SRR3900349/SRR3900349.recalibrated.bam", "./ibio_output_files/SRR3900288/SRR3900288.recalibrated.bam", "./ibio_output_files/SRR3900289/SRR3900289.recalibrated.bam", "./ibio_output_files/SRR3900347/SRR3900347.recalibrated.bam", "./ibio_output_files/SRR3900336/SRR3900336.recalibrated.bam", "./ibio_output_files/SRR3900337/SRR3900337.recalibrated.bam", "./ibio_output_files/SRR3900338/SRR3900338.recalibrated.bam", "./ibio_output_files/SRR3900339/SRR3900339.recalibrated.bam", "./ibio_output_files/SRR3900340/SRR3900340.recalibrated.bam", "./ibio_output_files/SRR3900341/SRR3900341.recalibrated.bam", "./ibio_output_files/SRR3900342/SRR3900342.recalibrated.bam", "./ibio_output_files/SRR3900343/SRR3900343.recalibrated.bam", "./ibio_output_files/SRR3900285/SRR3900285.recalibrated.bam", "./ibio_output_files/SRR3900284/SRR3900284.recalibrated.bam", "./ibio_output_files/SRR3900287/SRR3900287.recalibrated.bam", "./ibio_output_files/SRR515218/SRR515218.recalibrated.bam", "./ibio_output_files/ERR868003/ERR868003.recalibrated.bam", "./ibio_output_files/ERR868004/ERR868004.recalibrated.bam", "./ibio_output_files/SRR3900345/SRR3900345.recalibrated.bam", "./ibio_output_files/SRR3900346/SRR3900346.recalibrated.bam", "./ibio_output_files/SRR3900350/SRR3900350.recalibrated.bam", "./ibio_output_files/SRR3900351/SRR3900351.recalibrated.bam", "./ibio_output_files/SRR3900282/SRR3900282.recalibrated.bam", "./ibio_output_files/SRR3900298/SRR3900298.recalibrated.bam", "./ibio_output_files/SRR3900315/SRR3900315.recalibrated.bam", "./ibio_output_files/SRR3900279/SRR3900279.recalibrated.bam", "./ibio_output_files/SRR3900280/SRR3900280.recalibrated.bam", "./ibio_output_files/SRR3900352/SRR3900352.recalibrated.bam", "./ibio_output_files/SRR3900353/SRR3900353.recalibrated.bam", "./ibio_output_files/SRR3952018/SRR3952018.recalibrated.bam", "./ibio_output_files/M10667/M10667.recalibrated.bam", "./ibio_output_files/M10668/M10668.recalibrated.bam", "./ibio_output_files/M10672/M10672.recalibrated.bam", "./ibio_output_files/M10673/M10673.recalibrated.bam", "./ibio_output_files/M10675/M10675.recalibrated.bam", "./ibio_output_files/M10676/M10676.recalibrated.bam", "./ibio_output_files/M10677/M10677.recalibrated.bam", "./ibio_output_files/M10678/M10678.recalibrated.bam", "./ibio_output_files/M10679/M10679.recalibrated.bam", "./ibio_output_files/M10681/M10681.recalibrated.bam", "./ibio_output_files/M10682/M10682.recalibrated.bam", "./ibio_output_files/M10683/M10683.recalibrated.bam", "./ibio_output_files/M10684/M10684.recalibrated.bam", "./ibio_output_files/M4809/M4809.recalibrated.bam", "./ibio_output_files/M4869/M4869.recalibrated.bam", "./ibio_output_files/M4990/M4990.recalibrated.bam", "./ibio_output_files/M5005/M5005.recalibrated.bam", "./ibio_output_files/M5112/M5112.recalibrated.bam", "./ibio_output_files/M6287/M6287.recalibrated.bam", "./ibio_output_files/M6304/M6304.recalibrated.bam", "./ibio_output_files/SRR3900283/SRR3900283.recalibrated.bam", "./ibio_output_files/SRR3900290/SRR3900290.recalibrated.bam", "./ibio_output_files/SRR3900344/SRR3900344.recalibrated.bam", "./ibio_output_files/SRR3900286/SRR3900286.recalibrated.bam", "./ibio_output_files/K745/K745.recalibrated.bam")
RefSeqNames = c("NC_009144.3", "NC_009145.3", "NC_009146.3", "NC_009147.3", "NC_009148.3", "NC_009149.3", "NC_009150.3", "NC_009151.3", "NC_009152.3", "NC_009153.3", "NC_009154.3", "NC_009155.3", "NC_009156.3", "NC_009157.3", "NC_009158.3", "NC_009159.3", "NC_009160.3", "NC_009161.3", "NC_009162.3", "NC_009163.3", "NC_009164.3", "NC_009165.3", "NC_009166.3", "NC_009167.3", "NC_009168.3", "NC_009169.3", "NC_009170.3", "NC_009171.3", "NC_009172.3", "NC_009173.3", "NC_009174.3", "NC_009175.3", "NC_001640.1")
sampleNames = c("BROOKS3147", "M4814", "M4815", "M4826", "SRR3900348", "SRR3900349", "SRR3900288", "SRR3900289", "SRR3900347", "SRR3900336", "SRR3900337", "SRR3900338", "SRR3900339", "SRR3900340", "SRR3900341", "SRR3900342", "SRR3900343", "SRR3900285", "SRR3900284", "SRR3900287", "SRR515218", "ERR868003", "ERR868004", "SRR3900345", "SRR3900346", "SRR3900350", "SRR3900351", "SRR3900282", "SRR3900298", "SRR3900315", "SRR3900279", "SRR3900280", "SRR3900352", "SRR3900353", "SRR3952018", "M10667", "M10668", "M10672", "M10673", "M10675", "M10676", "M10677", "M10678", "M10679", "M10681", "M10682", "M10683", "M10684", "M4809", "M4869", "M4990", "M5005", "M5112", "M6287", "M6304", "SRR3900283", "SRR3900290", "SRR3900344", "SRR3900286", "K745")
bamDataRanges <- getReadCountsFromBAM(BAMFiles,sampleNames, RefSeqNames, WL = 5000, parallel=4)
res <- cn.mops(bamDataRanges)
#Calculate integer copy numbers
results <- calcIntegerCopyNumbers(res)
segm <- as.data.frame(segmentation(results))
#Identify CNVs
CNVs <- as.data.frame(cnvs(results))
#Identify CNV regions
CNVRegions <- as.data.frame(cnvr(results))
#Output data
write.csv(segm,file='ibio_shetland_segmentation.csv')
write.csv(CNVs,file='ibio_shetland_CNVs.csv')
write.csv(CNVRegions,file='ibio_shetland_CNVR.csv')
